<?xml version="1.0"?>
<GhussakTweaks>
  <append xpath="/buffs/buff[@name='buffElementFreezing' or @name='buffElementCold']/effect_group">
    <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffGSKHazardousWElementColdHook40">
      <requirement name="!HasBuff" buff="buffGSKHazardousWElementColdHook40"/>
    </triggered_effect>
  </append>
  <append xpath="/buffs/buff[@name='buffElementSweltering' or @name='buffElementHot' ]/effect_group">
    <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffGSKHazardousWElementHotHook40">
      <requirement name="!HasBuff" buff="buffGSKHazardousWElementHotHook40"/>
    </triggered_effect>
  </append>
  <append xpath="/buffs">
    <buff name="buffGSKHazardousWBloodLoss53" icon_blink="true" icon="7dtdGskBloodLoss" description_key="buffGSKHazardousWBloodLossDesc">
      <damage_type value="BloodLoss"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathBloodLossLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardousWBloodLoss53"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardousWBloodLoss53"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="LTE" value="0.14"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathBloodLossLvl" operation="set" value="0"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="GT" value="0.14"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathBloodLossLvl" operation="set" value="1"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="GT" value="0.21"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathBloodLossLvl" operation="set" value="2"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="GT" value="0.28"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathBloodLossLvl" operation="set" value="3"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="GT" value="0.35"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathBloodLossLvl" operation="set" value="4"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="GTE" value="0.40"/>
        <!-- HELPGOOD: 40% is lethal -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathBloodLossLvl" operation="set" value="5"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="set" value="0">
          <requirement name="CVarCompare" cvar="fGSKBloodLoss" operation="LT" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKHazardousWBloodLoss53">
          <requirement name="CVarCompare" cvar="iGSKNearDeathBloodLossLvl" operation="Equals" value="0"/>
        </triggered_effect>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardWDryAirIndicator" hidden="false" remove_on_death="true" description_key="dkbuffGSKHazardWDryAirIndicator" icon="ui_game_symbol_thirst" icon_blink="true" icon_color="255,255,0">
      <damage_type value="Dehydration"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <display_value value="iGSKNearDeathDryHotLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <update_rate value="1"/>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKHazardWDryAirIndicator">
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="LT" value="1"/>
        </triggered_effect>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardWDryness40" icon="7dtdGskHazardDesert2" description_key="buffGSKHazardWDrynessDesc" name_key="DryAirHazard">
      <damage_type value="Dehydration"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathDryHotLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardWDryness40"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardWDryness40"/>
        <!-- HELPGOOD: cfg -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKHazDesWtrLim" operation="set" value="0.66"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKHazDesWetLim" operation="set" value="0.10"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="bGSKHazDesert" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="bGSKHazDesert" operation="set" value="1">
          <requirement name="CVarCompare" cvar="_underwater" operation="Equals" value="0"/>
          <requirement name="CVarCompare" cvar="fGSKShownWetnessPerc" operation="LT" value="@fGSKHazDesWetLim"/>
          <requirement name="StatComparePercCurrentToMax" stat="Water" operation="LTE" value="@fGSKHazDesWtrLim"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathDryHotTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="bGSKHazDesert" operation="Equals" value="1"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathDryHotTime" operation="subtract" value="14" help="was 7, somewhat slow">
          <requirement name="CVarCompare" cvar="bGSKHazDesert" operation="Equals" value="0"/>
          <requirement name="CVarCompare" cvar="fGSKFireHeatingMult" operation="Equals" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathDryHotTime" operation="set" value="0">
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotTime" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathDryHotLvl" operation="set" value="@iGSKNearDeathDryHotTime"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathDryHotLvl" operation="divide" value="60"/>
      </effect_group>
      <effect_group help="NoseBleed">
        <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="GTE" value="1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKNoseBleedChk" operation="set" value="@fGSKBloodLoss"/>
        <triggered_effect help="FixTinyRandomFloat:was fGSKBloodLoss add randomFloat(0.005,0.015)" trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(5,15)"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.005,0.015)">
          <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=7611:        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="randomFloat(0.005,0.015)"> -->
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="Equals" value="1"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="5"/>
        </triggered_effect>
        <triggered_effect help="FixTinyRandomFloat:was fGSKBloodLoss add randomFloat(0.005,0.015)" trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(5,15)"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.005,0.015)">
          <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=7615:        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="randomFloat(0.005,0.015)"> -->
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="Equals" value="2"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="5"/>
        </triggered_effect>
        <triggered_effect help="FixTinyRandomFloat:was fGSKBloodLoss add randomFloat(0.005,0.015)" trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(5,15)"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.005,0.015)">
          <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=7619:        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="randomFloat(0.005,0.015)"> -->
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="Equals" value="3"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="5"/>
        </triggered_effect>
        <triggered_effect help="FixTinyRandomFloat:was fGSKBloodLoss add randomFloat(0.005,0.015)" trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(5,15)"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.005,0.015)">
          <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=7623:        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="randomFloat(0.005,0.015)"> -->
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="Equals" value="4"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="5"/>
        </triggered_effect>
        <triggered_effect help="FixTinyRandomFloat:was fGSKBloodLoss add randomFloat(0.005,0.015)" trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(5,15)"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.005,0.015)">
          <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=7627:        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKBloodLoss" operation="add" value="randomFloat(0.005,0.015)"> -->
          <requirement name="CVarCompare" cvar="iGSKNearDeathDryHotLvl" operation="GTE" value="5"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="5"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ShowToolbeltMessage" message="[TNM] Too dry, your nose bleeds.">
          <requirement name="CVarCompare" cvar=".fGSKNoseBleedChk" operation="LT" value="@fGSKBloodLoss"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffGSKHazardWDryAirIndicator">
          <requirement name="!HasBuff" buff="buffGSKHazardWDryAirIndicator"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="iGSKNearDeathDryHotLvl" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="iGSKNearDeathDryHotTime" operation="set" value="0"/>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardWWetFreezingAndHunger27" name_key="FreezingHazard" icon="7dtdGskHazardSnow" description_key="buffGSKHazardWWetFreezingAndHungerDesc">
      <damage_type value="Cold"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathFreezingLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardWWetFreezingAndHunger27"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardWWetFreezingAndHunger27"/>
        <!-- HELPGOOD: cfg -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKHazSnoFodLim" operation="set" value="0.66"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKHazSnoWetLim" operation="set" value="0.10"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKHazSnoFatLim" operation="set" value="0.20"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingLvl" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="bGSKHWWetFod" operation="set" value="0"/>
        <!-- HELPGOOD: <requirements compare_type="or"> doestn work here? -->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="bGSKHWWetFod" operation="set" value="1">
          <requirement name="CVarCompare" cvar="_underwater" operation="Equals" value="1"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="bGSKHWWetFod" operation="set" value="1">
          <requirement name="CVarCompare" cvar="fGSKShownWetnessPerc" operation="GT" value="@fGSKHazSnoWetLim"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="bGSKHWWetFod" operation="set" value="1">
          <requirement name="StatComparePercCurrentToMax" stat="Food" operation="LTE" value="@fGSKHazSnoFodLim"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="bGSKHWWetFod" operation="Equals" value="1"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingTime" operation="subtract" value="7">
          <requirement name="CVarCompare" cvar="bGSKHWWetFod" operation="Equals" value="0"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="bGSKHWWetFod" operation="Equals" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFZHeatingTmSub" operation="set" value="@fGSKFireHeatingMult"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKFZHeatingTmSub" operation="multiply" value="3"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingTime" operation="subtract" value="@.fGSKFZHeatingTmSub"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNearDeathFreezingTime" operation="GTE" value="60"/>
        <requirement name="CVarCompare" cvar="fGSKFatStaminaBlockage" operation="GTE" value="@fGSKHazSnoFatLim"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingTime" operation="add" value="-60"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKFatStaminaBlockage" operation="subtract" value="@fGSKHazSnoFatLim"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingTime" operation="set" value="0">
          <requirement name="CVarCompare" cvar="iGSKNearDeathFreezingTime" operation="LT" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingLvl" operation="set" value="@iGSKNearDeathFreezingTime"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFreezingLvl" operation="divide" value="60"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="iGSKNearDeathFreezingLvl" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyCVar" cvar="iGSKNearDeathFreezingTime" operation="set" value="0"/>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardousWMiasmaDirtyB45" icon="7dtdGskMiasma" icon_blink="true" hidden="false" remove_on_death="true" description_key="buffGSKHazardousWMiasmaDirtyBDesc" name_key="HazardousMiasma">
      <damage_type value="Toxic"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathMiasmaLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardousWMiasmaDirtyB45"/>
        <triggered_effect trigger="onSelfBuffStart" action="CVarLogValue" cvar="fGSKMiasmaDirty"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardousWMiasmaDirtyB45"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="3200" help="after 3600 danger, needs to drop below 3200 for safety"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKHazardousWMiasmaDirtyB45"/>
      </effect_group>
      <effect_group help="set miasma ND lvl">
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathMiasmaLvl" operation="set" value="0">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="3600"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathMiasmaLvl" operation="set" value="1">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="GT" value="3600"/>
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="4300"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathMiasmaLvl" operation="set" value="2">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="GT" value="4300"/>
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="5000"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathMiasmaLvl" operation="set" value="3">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="GT" value="5000"/>
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="5700"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathMiasmaLvl" operation="set" value="4">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="GT" value="5700"/>
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="6400"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathMiasmaLvl" operation="set" value="5">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="GT" value="6400"/>
        </triggered_effect>
      </effect_group>
      <effect_group help="add extra problems">
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffDysenteryCatchDrink">
          <requirement name="!HasBuff" buff="buffDysenteryMain"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="@iGSKNearDeathMiasmaLvl"/>
        </triggered_effect>
      </effect_group>
      <effect_group help="indicators. TODO add cfg activator to disable this in case the flies sound become too annoying">
        <requirement name="CVarCompare" cvar=".iGSKAllowMiasmaIndicator" operation="Equals" value="2"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="AttachParticleEffectToEntity" particle="#@modfolder(0-XNPCCore):Resources/Bugs.unity3d?p_Flies0_X" local_offset="0,0.5,0.3" local_rotation="0,0,0" parent_transform="Origin">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="GT" value="3000"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveParticleEffectFromEntity" particle="p_Flies0_X" compare_type="or">
          <requirement name="CVarCompare" cvar="fGSKMiasmaDirty" operation="LTE" value="3000"/>
          <requirement name="CVarCompare" cvar="iGSKNearDeathMiasmaLvl" operation="Equals" value="3"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="AttachParticleEffectToEntity" particle="#@modfolder(0-XNPCCore):Resources/Bugs.unity3d?p_Flies_X" local_offset="0,0.5,0.3" local_rotation="0,0,0" parent_transform="Origin">
          <requirement name="CVarCompare" cvar="iGSKNearDeathMiasmaLvl" operation="Equals" value="3"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveParticleEffectFromEntity" particle="p_Flies_X" compare_type="or">
          <requirement name="CVarCompare" cvar="iGSKNearDeathMiasmaLvl" operation="LT" value="3"/>
          <requirement name="CVarCompare" cvar="iGSKNearDeathMiasmaLvl" operation="Equals" value="5"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="AttachParticleEffectToEntity" particle="#@modfolder(0-XNPCCore):Resources/Bugs.unity3d?p_Flies2_X" local_offset="0,0.5,0.3" local_rotation="0,0,0" parent_transform="Origin">
          <requirement name="CVarCompare" cvar="iGSKNearDeathMiasmaLvl" operation="Equals" value="5"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveParticleEffectFromEntity" particle="p_Flies2_X">
          <requirement name="CVarCompare" cvar="iGSKNearDeathMiasmaLvl" operation="LT" value="5"/>
        </triggered_effect>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardousWElementColdHook40" icon="7dtdGskHazardSnow" icon_blink="true" hidden="false" remove_on_death="true" name_key="HypothermyHazard" description_key="buffGSKHazardousWElementColdHookDESC">
      <damage_type value="Cold"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathFreezingLvl" help="create a buff to indicate iGSKNearDeathFrostbyteLvl lvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardousWElementColdHook40"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardousWElementColdHook40"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKHazardousWElementColdHook40">
          <requirement name="CVarCompare" cvar="iGSKNDHWTime" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LTE" value="-30"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-30"/>
          <requirement name="CVarCompare" cvar="_coretemp" operation="LTE" value="-20"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-20"/>
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-10"/>
        </triggered_effect>
      </effect_group>
      <effect_group help="frostbyte is rare but may happen suddenly with a big value">
        <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="GT" value="99"/>
        <!--        HELPGOOD: by temperature-->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.10)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.15)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-10"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.20)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-20"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.30)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-30"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.40)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-40"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.50)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-50"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.60)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-60"/>
        </triggered_effect>
        <!--        HELPGOOD: extra by wetness-->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,0.50)">
          <requirement name="CVarCompare" cvar="fGSKShownWetnessPerc" operation="GTE" value="0.10"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathFrostbyteLvl" operation="add" value="randomFloat(0,1.0)">
          <requirement name="CVarCompare" cvar="_underwater" operation="Equals" value="1"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="0.333">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-30"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="0.333">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-20"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="0.333">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-10"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="6" help="from lvl 5 300s to lvl 1 60s is 240s/6=40s to recover. Heating, recovering from cold you need to be warm.">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="2">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="10"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="2">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="20"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="2">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="30"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKHWHeatingTmSub" operation="set" value="@fGSKFireHeatingMult"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKHWHeatingTmSub" operation="multiply" value="10"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="@.fGSKHWHeatingTmSub"/>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardousWElementHotHook40" icon="7dtdGskHazardDesert" icon_blink="true" hidden="false" remove_on_death="true" name_key="OverheatHazard" description_key="buffGSKHazardousWElementHotHookDESC">
      <damage_type value="Heat"/>
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathDryHotLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardousWElementHotHook40"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardousWElementHotHook40"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKHazardousWElementHotHook40">
          <requirement name="CVarCompare" cvar="iGSKNDHWTime" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="10"/>
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="20"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GTE" value="20"/>
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="30"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="add" value="1">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GTE" value="30"/>
        </triggered_effect>
      </effect_group>
      <effect_group help="sweating adds dirty">
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKMiasmaDirty" operation="add" value="randomFloat(1.5,3)" help="was 10to30, but it is per second, was too much.., miasma became a greater hazard than heat itself...">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="10"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKMiasmaDirty" operation="add" value="randomFloat(1.5,3)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="20"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fGSKMiasmaDirty" operation="add" value="randomFloat(1.5,3)">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="30"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKFireHeatingMult" operation="Equals" value="0"/>
        <!-- HELPGOOD: this would actually cause a flu...
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="6">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-30" />
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="5">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-20" />
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="4">
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="-10" />
        </triggered_effect>
-->
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="4" help="from lvl 5 300s to lvl 1 60s is 240s/4=60s to recover. Cooling, recovering from warm, you CANNOT be too cold or you may get a flu.">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-10"/>
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="10"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="2" help="Bonus for perfect temperature">
          <requirement name="CVarCompare" cvar="_coretemp" operation="GT" value="-1"/>
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="1"/>
        </triggered_effect>
        <!-- HELPGOOD:
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="0.333">
          <requirement name="CVarCompare" cvar="fGSKFireHeatingMult" operation="Equals" value="0" />
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="10" />
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="0.333">
          <requirement name="CVarCompare" cvar="fGSKFireHeatingMult" operation="Equals" value="0" />
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="20" />
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="0.333">
          <requirement name="CVarCompare" cvar="fGSKFireHeatingMult" operation="Equals" value="0" />
          <requirement name="CVarCompare" cvar="_coretemp" operation="LT" value="30" />
        </triggered_effect>
-->
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="_wetness" operation="GT" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKWetVsHeat" operation="set" value="@_wetness"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fGSKWetVsHeat" operation="multiply" value="3.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="subtract" value="@.fGSKWetVsHeat"/>
      </effect_group>
    </buff>
    <buff name="buffGSKHazardousWeather58" icon="7dtdGskHazardWeather" icon_blink="true" hidden="false" remove_on_death="true" description_key="buffGSKHazardousWeatherDesc" name_key="HazardousWeatherAndEnvironment">
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeathHazadousWeatherLvl"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:START:buffGSKHazardousWeather"/>
        <triggered_effect trigger="onSelfBuffRemove" action="LogMessage" message="GSK:REMOVED:buffGSKHazardousWeather"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKNDHWTime" operation="set" value="1">
          <requirement name="CVarCompare" cvar="iGSKNDHWTime" operation="LTE" value="0"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNDHWTime" operation="LTE" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathHazadousWeatherLvl" operation="set" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKHazardousWeather58"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathHazadousWeatherLvl" operation="set" value="@iGSKNDHWTime"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathHazadousWeatherLvl" operation="divide" value="60"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNDHWTime" operation="set" value="300">
          <requirement name="CVarCompare" cvar="iGSKNDHWTime" operation="GT" value="300"/>
        </triggered_effect>
      </effect_group>
    </buff>
    <buff name="buffGSKNearDeath40" hidden="false" remove_on_death="true" icon="ui_game_symbol_near_death_trauma" icon_color="255,128,128" icon_blink="true" description_key="buffGSKNearDeathDesc" name_key="NearDeathLevels">
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="1"/>
      <display_value value="iGSKNearDeath"/>
      <display_value_key value="{0:0.0}/5"/>
      <requirements>
        <requirement name="EntityTagCompare" tags="player"/>
        <requirement name="!HasBuff" buff="buffGSKGodMode"/>
        <requirement name="!HasBuff" buff="god" help="TODO: why does not work?"/>
      </requirements>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="0"/>
      </effect_group>
      <effect_group>
        <requirement name="!HasBuff" buff="buffGSKGodMode"/>
        <requirement name="!HasBuff" buff="god"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathLowCostTeleportLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathLowCostTeleportLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathCriticalHitLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathCriticalHitLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathPsyPowerLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathPsyPowerLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathBloodLossLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathBloodLossLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathMiasmaLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathMiasmaLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathFreezingLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathFreezingLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathDryHotLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathDryHotLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathRadiationLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathRadiationLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathPoisonLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathPoisonLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathHazadousWeatherLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathHazadousWeatherLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathFrostbyteLvl">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathFrostbyteLvl"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathBloated">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathBloated"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathOverhydrated">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathOverhydrated"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathChemUse">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathChemUse"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="@iGSKNearDeathRewindTime">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="@iGSKNearDeathRewindTime"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeath" operation="set" value="0">
          <requirement name="CVarCompare" cvar="iGSKNearDeathProtectionCBM" operation="Equals" value="1"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKNearDeath40">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="1"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fHWBlockageStamTmp" operation="set" value="28" help="max is 75% of this value, so 21"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fNearDeathBlockageStam" operation="set" value="0">
          <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="1"/>
        </triggered_effect>
      </effect_group>
      <!-- HELPGOOD: existing ModifyScreenEffect options (?) from resources.assets, read also Data/Config/XML.txt
				ISSUE: how is the bleeding ModifyScreenEffect applied? there is nothing there... could be thru the damage_type=bloodloss? TODO: use bleeding screen effect to hint when stepping over pointy fences, losing HP cuz of neardeath conditions or when using wight power. May be call a new buff buffInjuryBleedingMinor like buffInjuryBleedingOne but with bleedcounter=0.25 and force a duration of 1s only?
        AtDeath (MAYBE)
        Beer (no)
        Bright (no)
        Cold (no)
        Crouched
        Crouching
        Dark (weak)
        Death (MAYBE.no, only 1.0?)
        Drugs
        FireSmallLoop ?
        HalfHealth (may be?)
        Painkillers
        Spawn
        SpawnIn
        Stealth
        Tonemapping ?
        Vibrant
        VibrantDeSat (nice but too bright at 1.0)
      -->
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="GTE" value="1"/>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="2"/>
        <passive_effect name="RunSpeed" operation="perc_subtract" value="0.20"/>
        <passive_effect name="WalkSpeed" operation="perc_subtract" value="0.20"/>
        <passive_effect name="CrouchSpeed" operation="perc_subtract" value="0.20"/>
        <passive_effect name="AttacksPerMinute" operation="perc_subtract" value="0.15"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fHWBlockageStamTmp" operation="multiply" value="0.15"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKHPLossWithEffectIndicator" operation="add" value="-0.1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.72" fade="5.0" compare_type="or" help="vibrant actually helps on darkening the screen. intensity was 0.80 but becomes too dark at night">
          <requirement name="InBiome" biome="3" help="desert5 snow1 forest3 wasteland8"/>
          <requirement name="InBiome" biome="8" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.76" fade="5.0" help="with 0.96 we cant see the floor at night on desert" compare_type="or">
          <requirement name="InBiome" biome="5" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.80" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="1" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Drunk" intensity="0.10" fade="5.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Distortion" intensity="0.00" fade="5.0"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="GTE" value="2"/>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="3"/>
        <passive_effect name="RunSpeed" operation="perc_subtract" value="0.40"/>
        <passive_effect name="WalkSpeed" operation="perc_subtract" value="0.40"/>
        <passive_effect name="CrouchSpeed" operation="perc_subtract" value="0.40"/>
        <passive_effect name="AttacksPerMinute" operation="perc_subtract" value="0.30"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fHWBlockageStamTmp" operation="multiply" value="0.30"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKHPLossWithEffectIndicator" operation="add" value="-0.15"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.75" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="3" help="desert5 snow1 forest3 wasteland8"/>
          <requirement name="InBiome" biome="8" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.84" fade="5.0" help="with 0.96 we cant see the floor at night on desert" compare_type="or">
          <requirement name="InBiome" biome="5" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.89" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="1" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Drunk" intensity="0.20" fade="5.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Distortion" intensity="0.00" fade="5.0"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="GTE" value="3"/>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="4"/>
        <passive_effect name="RunSpeed" operation="perc_subtract" value="0.60"/>
        <passive_effect name="WalkSpeed" operation="perc_subtract" value="0.60"/>
        <passive_effect name="CrouchSpeed" operation="perc_subtract" value="0.60"/>
        <passive_effect name="AttacksPerMinute" operation="perc_subtract" value="0.45"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fHWBlockageStamTmp" operation="multiply" value="0.45"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKHPLossWithEffectIndicator" operation="add" value="-0.2"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.78" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="3" help="desert5 snow1 forest3 wasteland8"/>
          <requirement name="InBiome" biome="8" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.88" fade="5.0" help="with 0.96 we cant see the floor at night on desert" compare_type="or">
          <requirement name="InBiome" biome="5" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.93" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="1" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Drunk" intensity="0.40" fade="5.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Distortion" intensity="0.00" fade="5.0"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="GTE" value="4"/>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="LT" value="5"/>
        <passive_effect name="RunSpeed" operation="perc_subtract" value="0.80"/>
        <passive_effect name="WalkSpeed" operation="perc_subtract" value="0.80"/>
        <passive_effect name="CrouchSpeed" operation="perc_subtract" value="0.80"/>
        <passive_effect name="AttacksPerMinute" operation="perc_subtract" value="0.60"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fHWBlockageStamTmp" operation="multiply" value="0.60"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKHPLossWithEffectIndicator" operation="add" value="-0.25"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.81" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="3" help="desert5 snow1 forest3 wasteland8"/>
          <requirement name="InBiome" biome="8" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.90" fade="5.0" help="with 0.96 we cant see the floor at night on desert" compare_type="or">
          <requirement name="InBiome" biome="5" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.95" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="1" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Drunk" intensity="1.00" fade="5.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Distortion" intensity="0.00" fade="5.0"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="iGSKNearDeath" operation="GTE" value="5"/>
        <passive_effect name="RunSpeed" operation="perc_subtract" value="0.90"/>
        <passive_effect name="WalkSpeed" operation="perc_subtract" value="0.90"/>
        <passive_effect name="CrouchSpeed" operation="perc_subtract" value="0.90"/>
        <passive_effect name="AttacksPerMinute" operation="perc_subtract" value="0.75"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".fHWBlockageStamTmp" operation="multiply" value="0.75"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKHPLossWithEffectIndicator" operation="add" value="-0.33"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.84" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="3" help="desert5 snow1 forest3 wasteland8"/>
          <requirement name="InBiome" biome="8" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.92" fade="5.0" help="with 0.96 we cant see the floor at night on desert" compare_type="or">
          <requirement name="InBiome" biome="5" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0.98" fade="5.0" compare_type="or">
          <requirement name="InBiome" biome="1" help="desert5 snow1 forest3 wasteland8"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Drunk" intensity="1.00" fade="5.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Distortion" intensity="1.00" fade="5.0"/>
      </effect_group>
      <effect_group>
        <requirement name="!HasBuff" buff="buffGSKGodMode"/>
        <requirement name="!HasBuff" buff="god"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="fNearDeathBlockageStam" operation="set" value="@.fHWBlockageStamTmp" help="must be set after calc on the tmp to prevent it varying"/>
        <passive_effect name="StaminaMaxBlockage" operation="base_add" value="@fNearDeathBlockageStam"/>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKNearDeath40" compare_type="or">
          <requirement name="HasBuff" buff="buffGSKGodMode"/>
          <requirement name="HasBuff" buff="god"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" effect_name="Vibrant" intensity="0" fade="10"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" effect_name="Drunk" intensity="0" fade="10"/>
        <triggered_effect trigger="onSelfBuffRemove" action="ModifyScreenEffect" effect_name="Distortion" intensity="0" fade="10"/>
      </effect_group>
    </buff>
  </append>
</GhussakTweaks>
