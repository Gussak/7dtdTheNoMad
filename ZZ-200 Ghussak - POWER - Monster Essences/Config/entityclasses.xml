<?xml version="1.0"?>
<GhussakTweaks>
  <!--
	HELPGOOD: TODO: move monsters stuff to here
-->
  <append xpath="/entity_classes/entity_class[@name='playerMale']/effect_group/triggered_effect[(@trigger='onSelfEnteredGame' or @trigger='onSelfRespawn') and @action='AddBuff' and @target='self']/@buff">,buffGSKMutant_ChkAndApplyOnMobs21</append>
  <append xpath="/entity_classes/entity_class[starts-with(@name,'zombieWight')]">
    <property name="MoveSpeedAggro" value="6.0, 8.0" help="doesnt seem to work, using buffGSKWightPower instead"/>
    <effect_group>
      <triggered_effect trigger="onSelfFirstSpawn" action="AddBuff" target="self" buff="buffGSKWightPower"/>
    </effect_group>
    <property name="LootDropProb" value="1.0"/>
    <property name="LootDropEntityClass" value="EntityLootContainerWight"/>
  </append>
  <append xpath="/entity_classes/entity_class[starts-with(@name,'zombieScreamer')]" help="vampire">
    <effect_group help="vampire permanent added powers">
      <passive_effect name="HealthMax" operation="base_add" value="@iGSKVampireBuff"/>
      <passive_effect name="StaminaMax" operation="base_add" value="@iGSKVampireBuff"/>
      <triggered_effect trigger="onSelfFirstSpawn" action="AddBuff" target="self" buff="buffGSKVampPower"/>
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar="iGSKVampireBuffMax" operation="set" value="3000"/>
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar="iGSKVampireBuffHalfMax" operation="set" value="@iGSKVampireBuffMax"/>
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar="iGSKVampireBuffHalfMax" operation="divide" value="2"/>
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar="iGSKVampireBuff10perc" operation="set" value="@iGSKVampireBuffMax"/>
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar="iGSKVampireBuff10perc" operation="divide" value="10"/>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" cvar="iGSKVampireBuff" operation="add" value="@iGSKVampireBuffHalfMax">
        <requirement name="CVarCompare" cvar="iGSKVampireBuff" operation="Equals" value="0"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" cvar="iGSKVampireBuff" operation="add" value="@iGSKVampireBuff10perc">
        <requirement name="StatCompareCurrent" stat="Health" operation="LT" value="@iGSKVampireBuffMax"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyStats" stat="Health" operation="add" value="1000"/>
      <triggered_effect trigger="onSelfDamagedOther" action="AddBuff" target="other" buff="buffGSKBeastFangsHoldup">
        <requirement name="RandomRoll" seed_type="Random" min_max="0,3000" operation="LT" value="@iGSKVampireBuff" help="sync with iGSKVampireBuffMax"/>
      </triggered_effect>
      <!-- HELPGOOD: max is 3 = 75% chance, the stronger the vamp is greater the chance -->
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" target="other" cvar=".iGSKTryRagdollSelf" operation="add" value="1">
        <requirement name="CVarCompare" cvar="iGSKVampireBuff" operation="GT" value="500"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" target="other" cvar=".iGSKTryRagdollSelf" operation="add" value="1">
        <requirement name="CVarCompare" cvar="iGSKVampireBuff" operation="GT" value="1500"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" target="other" cvar=".iGSKTryRagdollSelf" operation="add" value="1">
        <requirement name="CVarCompare" cvar="iGSKVampireBuff" operation="GT" value="2500"/>
      </triggered_effect>
    </effect_group>
    <effect_group help="vampire night powers">
      <requirement name="IsNight"/>
      <passive_effect name="RunSpeed" operation="perc_add" value="2.0"/>
      <passive_effect name="AttacksPerMinute" operation="perc_add" value="1.0" help="FAILS?"/>
      <passive_effect name="JumpStrength" operation="perc_add" value="3.0" help="works?"/>
      <!--      HELPGOOD: 5 let it spawn 3, goal is TOT(3) + 2 = 5 = INIT value. If you want 3, you have to set to 5.
        1st hit: 5; -1=4>1; spawn 1
        2nd hit: 4; -1=3>1; spawn 2
        3rd hit: 3; -1=2>1; spawn 3
        4th hit: 2; -1=1 STOP: Wont be 0 so wont init. Being 1 will fail on GT 1. So STOPs
-->
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" cvar=".iGSKVampCallsThrawlSelf" operation="set" value="5">
        <requirement name="CVarCompare" cvar=".iGSKVampCallsThrawlSelf" operation="Equals" value="0" help="tot=3 +2 = 5=init"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" cvar=".iGSKVampCallsThrawlSelf" operation="add" value="-1">
        <requirement name="CVarCompare" cvar=".iGSKVampCallsThrawlSelf" operation="GT" value="1"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" target="other" cvar=".iGSKVampCallsThrawl" operation="add" value="1" target_tags="player">
        <requirement name="CVarCompare" cvar=".iGSKVampCallsThrawlSelf" operation="GT" value="1"/>
      </triggered_effect>
    </effect_group>
    <property name="LootDropProb" value="1.0"/>
    <property name="LootDropEntityClass" value="EntityLootContainerVampire"/>
  </append>
  <append xpath="/entity_classes/entity_class[starts-with(@name,'zombieScreamer')]/property[@name='Tags']/@value">,vampire</append>
  <append xpath="/entity_classes/entity_class[contains(@name,'Wight')]/property[@name='Tags']/@value">,wight</append>
  <append xpath="/entity_classes">
    <entity_class name="EntityLootContainerWight">
      <property name="Class" value="EntityLootContainer"/>
      <property name="HideInSpawnMenu" value="true"/>
      <property name="Mesh" value="@:Other/Items/Food/bottled_waterPrefab.prefab" help="a rolling entity may add some difficulty to acquire it, but this mesh may be heavy on slow GPUs?"/>
      <property name="SizeScale" value="2.5" help="ISSUE: FAILs while the server is running or the player is nearby but works when the server is restarted or player moves back from far away I think"/>
      <property name="ModelType" value="Custom"/>
      <property name="Prefab" value="Backpack"/>
      <property name="Parent" value="Backpack"/>
      <property name="IsEnemyEntity" value="false"/>
      <property name="TimeStayAfterDeath" value="36000"/>
      <property name="LootListOnDeath" value="zPackWight"/>
      <property name="Faction" value="None"/>
    </entity_class>
    <entity_class name="EntityLootContainerVampire" extends="EntityLootContainerWight">
      <property name="LootListOnDeath" value="zPackVampire"/>
    </entity_class>
    <entity_class name="EntityLootContainerMutant" extends="EntityLootContainerWight">
      <property name="LootListOnDeath" value="zPackMutant"/>
    </entity_class>
  </append>
  <append xpath="/entity_classes/entity_class[@name='animalRabbit' or starts-with(@name,'zombieMutated') or @name='animalZombieVultureRadiated']/property[@name='Tags']/@value">,mutant</append>
  <append xpath="/entity_classes/entity_class[starts-with(@name,'zombieMutated') or @name='animalZombieVultureRadiated']/property[@name='Tags']/@value">,perkAT01,perkAT02,perkAT03</append>
  <append xpath="/entity_classes/entity_class[starts-with(@name,'zombieMutated') or @name='animalZombieVultureRadiated']" help="they think like rabbits (mutant rabbit powers)">
    <property name="MapIcon" value="ui_game_symbol_tracking_rabbit"/>
    <property name="TrackerIcon" value="ui_game_symbol_tracking_rabbit"/>
    <property name="NavObject" value="animaltracking_rabbit"/>
  </append>
  <append xpath="/entity_classes/entity_class[@name='animalRabbit' or @name='zombieMutated' or @name='animalZombieVultureRadiated']">
    <effect_group>
      <triggered_effect trigger="onSelfFirstSpawn" action="AddBuff" target="self" buff="buffGSKMutantRabbits"/>
    </effect_group>
    <!--
		HELPGOOD:
		(clear;cd ..;egrep -\-color -iRhI -\-include=*.xml "AttachParticleEffectToEntity" *) |egrep 'particle="[^"]*"' -oi|sort -u
particle="p_bleeding"
particle="p_burning_barrel"
particle="p_candle_firstperson"
particle="p_electric_shock"
particle="p_fire_arrow_flaming_cloth"
particle="p_fire_flaming_arrow"
particle="p_gunfire_pistol"
particle="p_impact_metal_on_organic"
particle="p_nozzlesmokeuzi"
particle="p_onFire"
particle="p_sparks_fuse"
particle="p_torch_wall"
particle="p_twitch_smokePuff"
particle="p_twitch_zombie_fire_left"
particle="p_twitch_zombie_fire_right"
particle="p_twitch_zombie_radiation_left"
particle="p_twitch_zombie_radiation_right"
particle="p_twitch_zombie_shock_left"
particle="p_twitch_zombie_shock_right"
particle="RadiatedParticlesOnMesh"
particle="torch02_firePrefab"
    -->
    <property name="ParticleOnSpawn" value="torch02_firePrefab" param1="SetShapeToMesh0" help="ISSUE: find some light weight particle that looks like radiation again as RadiatedParticlesOnMesh was removed from vanilla"/>
  </append>
  <append xpath="/entity_classes/entity_class[@name='animalRabbit']">
    <drop event="Harvest" name="drugGSKAntiRadiation" count="7,28" tag="butcherHarvest"/>
    <drop event="Harvest" name="GSKsnakePoison" count="0,1" tag="butcherHarvest"/>
    <drop event="Harvest" name="drugGSKPsyonicsResist" count="0,3" tag="butcherHarvest"/>
    <drop event="Harvest" name="drugGSKmutantEssence" count="0,2" tag="butcherHarvest"/>
  </append>
  <append xpath="/entity_classes/entity_class[@name='animalZombieVultureRadiated']">
    <drop event="Harvest" name="drugGSKAntiRadiation" count="7,28" tag="butcherHarvest"/>
    <drop event="Harvest" name="GSKsnakePoison" count="1,4" tag="butcherHarvest"/>
    <drop event="Harvest" name="drugGSKPsyonicsResist" count="3,9" tag="butcherHarvest"/>
    <drop event="Harvest" name="drugGSKmutantEssence" count="2,6" tag="butcherHarvest"/>
  </append>
  <append xpath="/entity_classes/entity_class[starts-with(@name,'zombieMutated')]">
    <effect_group>
      <triggered_effect trigger="onSelfFirstSpawn" action="AddBuff" target="self" buff="buffGSKMutantZombies"/>
    </effect_group>
    <effect_group help="mutated permanent added powers, it is initially very strong">
      <passive_effect name="HealthMax" operation="perc_add" value="5"/>
      <passive_effect name="StaminaMax" operation="perc_add" value="5"/>
    </effect_group>
    <property name="LootDropProb" value="1.0"/>
    <property name="LootDropEntityClass" value="EntityLootContainerMutant"/>
  </append>
  <append xpath="/entity_classes/entity_class[@name='playerMale']">
    <effect_group>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" cvar=".iGSKPlayerVampireStrikeCount" operation="add" value="5">
        <requirement name="!EntityTagCompare" target="other" tags="zombie" help="only the living provides proper healing for the player"/>
        <requirement name="!EntityTagCompare" target="other" tags="mech"/>
        <requirement name="IsAlive" target="other" help="cuz shall not allow easy heal from fresh corpse"/>
        <requirement name="HasBuff" buff="buffGSKVampireEssence"/>
        <requirement name="!HasBuff" buff="buffGSKNPCproperSneakingProtectFoes" target="other"/>
        <requirement name="CVarCompare" cvar="iGSKMeleeParryChance" operation="GT" value="0" help="used as indicator to holding melee weapon"/>
        <requirement name="HoldingItemHasTags" tags="perkDeepCuts,perkJavelinMaster" help="only weapons that can pierce or cut, spears will work on melee only"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfDamagedOther" action="ModifyCVar" cvar=".iGSKPlayerVampireStrikeCount" operation="add" value="1" help="zombies provide minor healing only (this is mainly to make the essence actually useful as there are not many living beings around anymore, tho it lacks reasoning ;)), their vital force is corrupted and so is the health drain (could work? ;), or explaing thru magic means..)">
        <requirement name="EntityTagCompare" target="other" tags="zombie" help="heals only a bit from zombies"/>
        <requirement name="!EntityTagCompare" target="other" tags="mech"/>
        <requirement name="IsAlive" target="other" help="cuz shall not allow easy heal from fresh corpse"/>
        <requirement name="HasBuff" buff="buffGSKVampireEssence"/>
        <requirement name="!HasBuff" buff="buffGSKNPCproperSneakingProtectFoes" target="other"/>
        <requirement name="CVarCompare" cvar="iGSKMeleeParryChance" operation="GT" value="0" help="used as indicator to holding melee weapon"/>
        <requirement name="HoldingItemHasTags" tags="perkDeepCuts,perkJavelinMaster" help="only weapons that can pierce or cut, spears will work on melee only"/>
      </triggered_effect>
    </effect_group>
  </append>
  <append xpath="/entity_classes/entity_class[@name='playerMale']/property[     @name='ItemsOnEnterGame.GameModeSurvival'   or     @name='ItemsOnEnterGame.GameModeSurvivalSP' or     @name='ItemsOnEnterGame.GameModeSurvivalMP'    ]/@value" help="to be able to defeat wights easily too">,GlowStickGreen=30</append>
</GhussakTweaks>
