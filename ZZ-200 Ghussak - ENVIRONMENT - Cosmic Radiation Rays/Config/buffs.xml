<?xml version="1.0"?>
<GhussakTweaks>
  <append xpath="/buffs">
    <buff name="buffGSKNPCCosmicRayTrap" hidden="true" remove_on_death="true" help="ISSUE: zombies/animals/npcs do not check for _biomeradiation?">
      <stack_type value="replace"/>
      <update_rate value="0.05"/>
      <duration value="0"/>
      <effect_group>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".iGSKNPCCosmicRayTrap" operation="set" value="1">
          <requirement name="CVarCompare" cvar="_biomeradiation" operation="GT" value="2.5" help="clue for radiation.png"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar=".iGSKNPCCosmicRayTrap" operation="GTE" value="1" help="clue for radiation.png"/>
        <passive_effect name="RunSpeed" operation="perc_subtract" value="0.99"/>
        <passive_effect name="WalkSpeed" operation="perc_subtract" value="0.99"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar=".iGSKNPCCosmicRayTrap" operation="Equals" value="1" help="clue for radiation.png"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffBurningElementDuration" operation="set" value="600"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffBurningElement"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".buffShockedDurationStart" operation="set" value="600"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffShocked"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="CallGameEvent" event="eventGSKCosmicRayStrike" help="TODO: how to make this work for NPCs?"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".iGSKNPCCosmicRayTrap" operation="set" value="2"/>
      </effect_group>
    </buff>
    <buff name="buffGSKCosmicRayShield">
      <stack_type value="ignore"/>
      <duration value="0"/>
    </buff>
    <buff name="buffGSKCosmicRayStrikeChk14" hidden="true">
      <stack_type value="ignore"/>
      <duration value="0"/>
      <update_rate value="0.05"/>
      <effect_group help="chk allowed">
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".iGSKCosmicStrikeAllowed" operation="set" value="0"/>
      </effect_group>
      <effect_group help="chk allowed">
        <requirement name="!HasBuff" buff="buffGSKGodMode"/>
        <requirement name="!HasBuff" buff="god"/>
        <requirement name="!HasBuff" buff="buffGSKCosmicRayStrike13"/>
        <requirement name="CVarCompare" cvar="_biomeradiation" operation="GT" value="2.5" help="clue for radiation.png"/>
        <requirement name="CVarCompare" cvar="iGSKNPCcosmicRayDigger" operation="Equals" value="0"/>
        <requirement name="!IsBloodMoon"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".iGSKCosmicStrikeAllowed" operation="set" value="1"/>
      </effect_group>
      <effect_group help="chk allowed">
        <requirement name="CVarCompare" cvar="_biomeradiation" operation="GT" value="2.5" help="clue for radiation.png"/>
        <requirement name="CVarCompare" cvar="iGSKNPCcosmicRayDigger" operation="Equals" value="1"/>
        <requirement name="!IsBloodMoon"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar=".iGSKCosmicStrikeAllowed" operation="set" value="1"/>
      </effect_group>
      <effect_group help="CosmicRays">
        <requirement name="CVarCompare" cvar=".iGSKCosmicStrikeAllowed" operation="Equals" value="1"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffGSKCosmicRayStrike13"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffRadiation03"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="LogMessage" message="GSK:'buffGSKCosmicRayStrikeChk14':StrukByACosmicRayBeam"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar="fGSKCosmicRadMessDNA" operation="GT" value="1"/>
        <passive_effect name="HealthMaxBlockage" operation="base_add" value="@fGSKCosmicRadMessDNA"/>
      </effect_group>
      <effect_group help="Cosmic Blood Moon">
        <requirement name="IsBloodMoon"/>
        <requirement name="CVarCompare" cvar="_biomeradiation" operation="GT" value="2.5" help="clue for radiation.png"/>
        <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LTE" value="0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="AddBuff" buff="buffGSKCosmicBloodMoon7"/>
      </effect_group>
    </buff>
    <buff name="buffGSKCosmicBloodMoon7" icon="7dtdCosmicRayShield" icon_color="128,255,128" hidden="false" name_key="CosmicBloodMoon" description_key="dkbuffGSKCosmicBloodMoon" remove_on_death="false" help="this also works like a cooldown">
      <stack_type value="ignore"/>
      <display_value value="iGSKCosmicBloodMoonCoolDown"/>
      <display_value_key value="{0:0}&gt;90s" help="sync with: maxTime - .iGSKCosmicBloodMoonRageTmTot = iGSKCosmicBloodMoonRageTm"/>
      <duration value="0"/>
      <update_rate value="5" help="sync with iGSKCosmicBloodMoonCoolDown subtraction below"/>
      <effect_group help="init and effects">
        <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="player#drownsurface" play_in_head="true"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKCosmicBloodMoonCoolDown" operation="set" value="150" help="maxTime. sync: must be a multiple of the update_rate value"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKCosmicBloodMoonRageTmTot" operation="set" value="60" help="sync with more than ragdoll duration. sync: must be a multiple of the update_rate value"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKCosmicBloodMoonRageTm" operation="set" value="@iGSKCosmicBloodMoonCoolDown"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKCosmicBloodMoonRageTm" operation="subtract" value="@.iGSKCosmicBloodMoonRageTmTot"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKCosmicBloodMoonRageTmEndingHint" operation="set" value="@iGSKCosmicBloodMoonRageTm"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKCosmicBloodMoonRageTmEndingHint" operation="add" value="15" help="sync: must be a multiple of the update_rate value"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKCosmicBloodMoonCoolDown" operation="add" value="-5" help="sync with update_rate time!"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKCosmicBloodMoon7" compare_type="or">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LTE" value="0"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" effect_name="VibrantDeSat" intensity="0.66" fade="1.0" help="try to keep just a bit of color"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" effect_name="Infected" intensity="0.75" fade="10" help="1.0 intensity may be very difficult to find zombies fallen and not moving on the ground"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" effect_name="Cold2" intensity="1.00" fade="3.0"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyScreenEffect" effect_name="Hot2" intensity="1.00" fade="15.0"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Infected" intensity="0" fade="1">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LTE" value="@iGSKCosmicBloodMoonRageTmEndingHint"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Hot2" intensity="0" fade="2">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LTE" value="@iGSKCosmicBloodMoonRageTmEndingHint"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="Cold2" intensity="0" fade="3">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LTE" value="@iGSKCosmicBloodMoonRageTmEndingHint"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="VibrantDeSat" intensity="0.33" fade="3">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="Equals" value="@iGSKCosmicBloodMoonRageTmEndingHint"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyScreenEffect" effect_name="VibrantDeSat" intensity="0" fade="1">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LTE" value="@iGSKCosmicBloodMoonRageTm"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="PlaySound" sound="player#drownpain" play_in_head="true">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="Equals" value="@iGSKCosmicBloodMoonRageTmEndingHint"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="PlaySound" sound="player#drowndeath" play_in_head="true">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="Equals" value="@iGSKCosmicBloodMoonRageTm"/>
        </triggered_effect>
      </effect_group>
      <effect_group help="main effects good and bad">
        <triggered_effect trigger="onSelfBuffStart" action="Ragdoll" duration="30" force="250" target="selfAOE" range="30" target_tags="zombie,animal,bandit" help="so, this wont affect mobs spawned after the stricke, what is expected and ok."/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Health" operation="add" value="100"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyStats" stat="Stamina" operation="add" value="100"/>
        <triggered_effect help="FixTinyRandomFloat:was fGSKCosmicRadMessDNA subtract randomFloat(0.10,0.50)" trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(100,500)"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKCosmicRadMessDNA" operation="subtract" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.10,0.50)"/>
        <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=14412:        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKCosmicRadMessDNA" operation="subtract" value="randomFloat(0.10,0.50)"/> -->
        <triggered_effect help="FixTinyRandomFloat:was fGSKRadiationMessDNA subtract randomFloat(0.10,0.50)" trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(100,500)"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKRadiationMessDNA" operation="subtract" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.10,0.50)"/>
        <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=14413:        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKRadiationMessDNA" operation="subtract" value="randomFloat(0.10,0.50)"/> -->
        <triggered_effect help="FixTinyRandomFloat:was iGSKEssenceWight subtract randomFloat(0.10,0.50)" trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(100,500)"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKEssenceWight" operation="subtract" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.10,0.50)"/>
        <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=14414:        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKEssenceWight" operation="subtract" value="randomFloat(0.10,0.50)"/> -->
        <triggered_effect help="FixTinyRandomFloat:was iGSKEssenceVampire subtract randomFloat(0.10,0.50)" trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(100,500)"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKEssenceVampire" operation="subtract" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.10,0.50)"/>
        <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=14415:        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKEssenceVampire" operation="subtract" value="randomFloat(0.10,0.50)"/> -->
        <triggered_effect help="FixTinyRandomFloat:was iGSKEssenceMutant subtract randomFloat(0.10,0.50)" trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="set" value="randomInt(100,500)"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".fGSKFixTinyRandomFloatTmp" operation="divide" value="1000" help="FixTinyRandomFloat"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKEssenceMutant" operation="subtract" value="@.fGSKFixTinyRandomFloatTmp" help="FixTinyRandomFloat: was randomFloat(0.10,0.50)"/>
        <!-- HELPGOOD:FixTinyRandomFloat:OriginalLineData:LineNumber=14416:        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKEssenceMutant" operation="subtract" value="randomFloat(0.10,0.50)"/> -->
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$buffDrugOhShitzDropsDuration" operation="add" value="@.iGSKCosmicBloodMoonRageTmTot"/>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffDrugOhShitzDrops">
          <requirement name="NotHasBuff" buff="buffDrugOhShitzDrops"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="$buffStatusRadiation" operation="set" value="0">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="GTE" value="@iGSKCosmicBloodMoonRageTm"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathProtectionCBM" operation="set" value="1">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="GTE" value="@iGSKCosmicBloodMoonRageTm"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKNearDeathProtectionCBM" operation="set" value="0">
          <requirement name="CVarCompare" cvar="iGSKCosmicBloodMoonCoolDown" operation="LT" value="@iGSKCosmicBloodMoonRageTm"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffRadiation03"/>
      </effect_group>
      <effect_group help="over time buffs to let the player clear mobs in melee or ranged, the ending at 60s (sync with .iGSKCosmicBloodMoonRageTmTot) is meant to let the player run back to a safe location">
        <requirement name="CVarCompare" cvar="iGSKMeleeParryChance" operation="GT" value="0" help="used as indicator to holding melee weapon"/>
        <passive_effect name="StaminaChangeOT" operation="base_add" duration="0,5,10,55,60" value="0,33,50,50,0"/>
        <passive_effect name="HealthChangeOT" operation="base_add" duration="0,5,10,55,60" value="0,10,25,25,0"/>
        <passive_effect name="AttacksPerMinute" operation="perc_add" duration="0,5,10,55,60" value="0,2,3,3,0"/>
        <passive_effect name="JumpStrength" operation="perc_add" duration="0,5,10,55,60" value="0,1.5,3.5,3.5,0"/>
        <passive_effect name="RunSpeed" operation="perc_add" duration="0,5,10,55,60" value="0,1.5,2.5,2.5,0"/>
        <passive_effect name="WalkSpeed" operation="perc_add" duration="0,5,10,55,60" value="0,0.5,1.0,1.0,0"/>
      </effect_group>
    </buff>
    <buff name="buffGSKCosmicRayStrike13" icon="7dtdCosmicRayShield" hidden="false" name_key="CosmicRayStrike" description_key="dkbuffGSKCosmicRayStrike" remove_on_death="false" help="this also works like a cooldown, a shield against another strike">
      <stack_type value="ignore"/>
      <display_value value="iGSKCosmicStrikeCooldown"/>
      <display_value_key value="{0:0}s"/>
      <duration value="0"/>
      <update_rate value="2" help="this also controls the dig down mode speed. sync with iGSKCosmicStrikeCooldown subtraction below"/>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="iGSKCosmicStrikeCooldown" operation="set" value="300" help="TODO: should be 15, but 300 if using that aluminium hat GSKCosmicRayShield as a helmet mod xD"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="ModifyCVar" cvar="iGSKCosmicStrikeCooldown" operation="add" value="-2" help="sync with update_rate time!"/>
        <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffGSKCosmicRayStrike13" compare_type="or">
          <requirement name="CVarCompare" cvar="iGSKCosmicStrikeCooldown" operation="LTE" value="0"/>
          <requirement name="CVarCompare" cvar="iGSKNPCcosmicRayDigger" operation="Equals" value="1"/>
          <requirement name="IsBloodMoon"/>
        </triggered_effect>
      </effect_group>
      <effect_group>
        <triggered_effect trigger="onSelfBuffStart" action="ShowToolbeltMessage" message="[TNM] You got struck by a powerful Cosmic Ray beam!"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKCosmicStrikeMode" operation="set" value="randomInt(0,100)"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKCosmicStrikeDoIt" operation="set" value="1"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKCosmicStrikeDoIt" operation="set" value="0">
          <requirement name="HasBuff" buff="buffGSKCosmicRayShield"/>
          <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="75"/>
        </triggered_effect>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKCosmicStrikeDoIt" operation="set" value="0">
          <requirement name="HasBuff" buff="buffGSKMutantEssence"/>
        </triggered_effect>
      </effect_group>
      <effect_group help="telep in place, down a bit">
        <requirement name="CVarCompare" cvar=".iGSKCosmicStrikeDoIt" operation="Equals" value="1"/>
        <requirement name="CVarCompare" cvar=".iGSKCosmicStrikeMode" operation="GTE" value="5"/>
        <triggered_effect trigger="onSelfBuffStart" action="CallGameEvent" event="eventGSKCosmicRayStrike"/>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:'buffGSKCosmicRayStrike13':TeleportInPlaceDown1DigMode"/>
      </effect_group>
      <effect_group help="random dir telep, 5% chance, 1in20">
        <requirement name="CVarCompare" cvar=".iGSKCosmicStrikeDoIt" operation="Equals" value="1"/>
        <requirement name="CVarCompare" cvar=".iGSKCosmicStrikeMode" operation="LT" value="5"/>
        <requirement name="CVarCompare" cvar="iGSKNPCcosmicRayDigger" operation="Equals" value="0" help="random dir is rare to happen, so will just be ignored on normal/nonDigging mode to not mess the player intent"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKTeleRndDistIndexMax" operation="set" value="1" help="this limits the random distance of buffGSKElctrnTeleChoseRandomDirection"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar=".iGSKExternalForceTeleport" operation="add" value="1" help="this prevents energy usage on tele finalize etc"/>
        <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffGSKExternalForceTeleport"/>
        <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="GSK:'buffGSKCosmicRayStrike13':RandomDirTeleport"/>
      </effect_group>
      <effect_group>
        <requirement name="CVarCompare" cvar=".iGSKCosmicStrikeDoIt" operation="Equals" value="1"/>
        <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="fGSKCosmicRadMessDNA" operation="add" value="0.10"/>
        <triggered_effect trigger="onSelfBuffStart" action="Ragdoll" duration="6" force="250" target="selfAOE" range="15" target_tags="zombie,animal,bandit" help="this actually expectedly helps the player a bit"/>
        <triggered_effect trigger="onSelfBuffStart" target="selfAOE" range="2" action="AddBuff" buff="buffGSKTeleportExplosionDisintegrateFoes" help="this range is short, meant to be difficult to kill nearby foes (intentionally or unintentionally)">
          <requirement name="!EntityTagCompare" target="other" tags="player"/>
          <requirement name="CVarCompare" target="other" cvar="Leader" operation="NotEquals" value="@EntityID" help="protects followers and hired ones"/>
        </triggered_effect>
      </effect_group>
    </buff>
  </append>
  <remove xpath="/buffs/buff[@name='buffRadiation03']/effect_group/triggered_effect[@trigger='onSelfBuffStart' and @action='ModifyScreenEffect' and @effect_name='Radiation']"/>
  <set xpath="/buffs/buff[@name='buffRadiation03']/@icon">7dtdCosmicRayBeam</set>
  <set xpath="/buffs/buff[@name='buffRadiation03']/@icon_color">220,128,128</set>
  <append xpath="/buffs/buff[@name='buffRadiation03']/effect_group" help="prevents cosmic radiation while under effect of cosmic blood moon good buff. also during blood moon it is harmless.">
    <requirement name="!HasBuff" buff="buffGSKCosmicBloodMoon7"/>
    <requirement name="!IsBloodMoon"/>
  </append>
  <append xpath="/buffs/buff[@name='buffRadiation03']" help="this is also important because otherwise the protections above (that dont remove the buff) would let the increase of damage over time still be calculated there!!! as soon that conditions end, the player would receive high damage and die instantly!">
    <effect_group help="grants bloodmoon and cosmicblood moon make cosmic radiation harmless">
      <triggered_effect trigger="onSelfBuffUpdate" action="RemoveBuff" buff="buffRadiation03" compare_type="or">
        <requirement name="HasBuff" buff="buffGSKCosmicBloodMoon7"/>
        <requirement name="IsBloodMoon"/>
      </triggered_effect>
    </effect_group>
  </append>
  <!-- HELPGOOD: the vanilla initial 10s dmg of 1HP/s is good as indicator to call player attention, this below is bad:
    <set xpath="/buffs/buff[@name='buffRadiation03']/effect_group/passive_effect[@name='HealthChangeOT' and @operation='base_subtract' and @duration='0,10']/@value">0.1,1</set>
  -->
</GhussakTweaks>
