<?xml version="1.0"?>
<GhussakTweaks>
  <append xpath="/entity_classes/entity_class[     starts-with(@name,'zombieUtilityWorker') or     starts-with(@name,'zombieBiker') or     starts-with(@name,'zombieDemolition') or     starts-with(@name,'zombieSoldier') or     starts-with(@name,'mech')   ]">
    <property name="DismemberMultiplierHead" value="0" help="this prevents instakill random chance from any hit source right? only a few weapons should be able to dismember/explode the head, see the buff TODO here."/>
    <!--
    HELPGOOD: this doesnt protect their heads, just bugs and ends up preventing them from attacking right?
    <property name="ItemsOnEnterGame.GameModeSurvival" value="armorSteelHelmet" />
    <property name="ItemsOnEnterGame.GameModeSurvivalSP" value="armorSteelHelmet" />
    <property name="ItemsOnEnterGame.GameModeSurvivalMP" value="armorSteelHelmet" />   
-->
  </append>
  <append xpath="/entity_classes/entity_class[@name='mechSphereII']" help="fix it before other patches">
    <property name="Tags" value="entity,cp,mech,mechSphereII"/>
  </append>
  <append xpath="/entity_classes/entity_class[       starts-with(@name,'zombieUtilityWorker') or       starts-with(@name,'zombieBiker') or       @name='animalBear' or       @name='mechDrone' or       @name='mechSphereI' or       @name='mechSphereII' or       @name='mechBee'     ]/property[@name='Tags']/@value">,helmetWeak</append>
  <append xpath="/entity_classes/entity_class[       @name='animalZombieBear'     ]/property[@name='Tags']/@value">,helmetNormal</append>
  <append xpath="/entity_classes/entity_class[       starts-with(@name,'zombieSoldier') or       starts-with(@name,'zombieDemolition') or       @name='mechRobot' or       @name='mechRobotArmy'     ]/property[@name='Tags']/@value">,helmetStrong</append>
  <append xpath="/entity_classes/entity_class[       contains(@name,'mechDeusEx')     ]/property[@name='Tags']/@value">,helmetVanillaDamage</append>
  <append xpath="/entity_classes/entity_class[@name='playerMale']">
    <effect_group help="Headshot">
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="10">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd10"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="9">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd9"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="8">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd8"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="7">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd7"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="6">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd6"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="5">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd5"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="4">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd4"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="3">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd3"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="2">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd2"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="1">
        <requirement name="HoldingItemHasTags" tags="armorPiercingAdd1"/>
        <requirement name="HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="HitLocation" body_parts="Head"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="AddBuff" target="other" target_tags="zombie,animal,bandit,mech" buff="buffGSKHeadShot">
        <requirement name="HitLocation" body_parts="Head" help="this is about where the player is aiming and not where the target is receiving the hit right?"/>
        <requirement name="!HoldingItemHasTags" tags="shotgun"/>
      </triggered_effect>
    </effect_group>
    <effect_group help="Headshot by non AP shotgun pellets ISSUE: this will work even if just one of the pellets hit the head right?">
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="1">
        <requirement name="HitLocation" body_parts="Head"/>
        <requirement name="HoldingItemHasTags" tags="shotgun"/>
        <requirement name="!HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="GTE" value="5" help="This is from the EffectiveAndImmersiveWeaponsOverhaul. max is 20 pellets"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="LT" value="10"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="2">
        <requirement name="HitLocation" body_parts="Head"/>
        <requirement name="HoldingItemHasTags" tags="shotgun"/>
        <requirement name="!HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="GTE" value="10"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="LT" value="15"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="3">
        <requirement name="HitLocation" body_parts="Head"/>
        <requirement name="HoldingItemHasTags" tags="shotgun"/>
        <requirement name="!HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="GTE" value="15"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="LT" value="20"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="ModifyCVar" target="other" target_tags="zombie,animal,bandit,mech" cvar=".iGSKShotByArmorPiercing" operation="add" value="4">
        <requirement name="HitLocation" body_parts="Head"/>
        <requirement name="HoldingItemHasTags" tags="shotgun"/>
        <requirement name="!HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="CVarCompare" target="other" cvar="iEWPelletHitCount" operation="Equals" value="20"/>
      </triggered_effect>
      <triggered_effect trigger="onSelfAttackedOther" action="AddBuff" target="other" target_tags="zombie,animal,bandit,mech" buff="buffGSKHeadShot">
        <requirement name="HitLocation" body_parts="Head"/>
        <requirement name="HoldingItemHasTags" tags="shotgun"/>
        <requirement name="!HasBuff" buff="buffGSKEquippedArmorPiercingAmmo"/>
        <requirement name="CVarCompare" target="other" cvar=".iGSKShotByArmorPiercing" operation="GT" value="0"/>
      </triggered_effect>
    </effect_group>
  </append>
  <!-- HELPGOOD: some old tests that failed, DELETE
  <append xpath="/entity_classes/entity_class[@name='DISABLED_ThisWontWork' and
      (starts-with(@name,'zombie') or starts-with(@name,'animal') or starts-with(@name,'npc'))
      and contains(@name,'Template')
    ]" help="ISSUE: this doesnt work because DamageModifier is the damage given and not the damage received right?">
<!- -
    <effect_group help="Inform game Difficulty to foe">
      <triggered_effect trigger="onOtherDamagedSelf" action="ModifyCVar" cvar=".iGSKHSHPDifficulty" operation="set" value="@_difficulty"/>
    </effect_group>
- ->
    <effect_group help="HeadShot: insta kill (or almost) damage for non helmeted">
<!- -
      <requirement name="!EntityTagCompare" tags="helmetWeak,helmetNormal,helmetStrong" has_all_tags="true" help="negating all tags will work as 'and' like in: has_not_all_tags (I think)"/>
- ->
      <requirement name="!EntityTagCompare" tags="helmetWeak" />
      <requirement name="!EntityTagCompare" tags="helmetNormal" />
      <requirement name="!EntityTagCompare" tags="helmetStrong" />
      <passive_effect name="DamageModifier" operation="perc_set" value="1" tags="head" help="is this like a reset/override for any previous settings?"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="2.5" tags="head"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="2" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="2"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="4" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="3"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="6" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="4"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="8" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="5"/>
      </passive_effect>
<!- -
      <triggered_effect trigger="onOtherDamagedSelf" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="-1"/>
- ->
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="-1" />
    </effect_group>
    <effect_group help="HeadShot:helmetWeak">
      <requirement name="EntityTagCompare" tags="helmetWeak"/>
      <passive_effect name="DamageModifier" operation="perc_set" value="1" tags="head" help="is this like a reset/override for any previous settings?"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="2.5" tags="head"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="0.99" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="2"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="1.33" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="3"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="1.66" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="4"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="1.99" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="5"/>
      </passive_effect>
<!- -
      <triggered_effect trigger="onOtherDamagedSelf" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="1"/>
- ->
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="1" />
    </effect_group>
    <effect_group help="HeadShot:helmetNormal">
      <requirement name="EntityTagCompare" tags="helmetNormal"/>
      <passive_effect name="DamageModifier" operation="perc_set" value="1" tags="head" help="is this like a reset/override for any previous settings?"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="2.5" tags="head"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="0.66" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="2"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="0.99" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="3"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="1.33" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="4"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="1.66" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="5"/>
      </passive_effect>
<!- -
      <triggered_effect trigger="onOtherDamagedSelf" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="2"/>
- ->
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="2" />
    </effect_group>
    <effect_group help="HeadShot:helmetStrong">
      <requirement name="EntityTagCompare" tags="helmetStrong"/>
      <passive_effect name="DamageModifier" operation="perc_set" value="1" tags="head" help="is this like a reset/override for any previous settings?"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="2.5" tags="head"/>
      <passive_effect name="DamageModifier" operation="perc_add" value="0.33" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="2"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="0.66" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="3"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="0.99" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="4"/>
      </passive_effect>
      <passive_effect name="DamageModifier" operation="perc_add" value="1.33" tags="head" >
        <requirement name="CVarCompare" cvar=".iGSKHSHPDifficulty" operation="Equals" value="5"/>
      </passive_effect>
<!- -
      <triggered_effect trigger="onOtherDamagedSelf" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="3"/>
- ->
      <triggered_effect trigger="onSelfFirstSpawn" action="ModifyCVar" cvar=".iGSKHSHPHasHelmet" operation="set" value="3" />
    </effect_group>
  </append> 
-->
  <!-- HELPGOOD: some old tests that failed, DELETE, DamageModifier to LOWER head damage seems to not work, only to increase it works?
  <append xpath="/entity_classes/entity_class[@name='playerMale']">
    <effect_group help="HeadShot: less damage for helmetWeak">
      <requirement name="EntityTagCompare" tags="helmetWeak"/>
      <passive_effect name="DamageModifier" operation="perc_set" value="0.70" tags="head"/>
    </effect_group>
    <effect_group help="HeadShot: less damage for helmetNormal">
      <requirement name="EntityTagCompare" tags="helmetNormal"/>
      <passive_effect name="DamageModifier" operation="perc_set" value="0.40" tags="head"/>
    </effect_group>
    <effect_group help="HeadShot: less damage for helmetStrong">
      <requirement name="EntityTagCompare" tags="helmetStrong"/>
      <passive_effect name="DamageModifier" operation="perc_set" value="0.10" tags="head"/>      
    </effect_group>
    <effect_group help="HeadShot: much less damage for mechs reiforced cpu shield">
      <requirement name="EntityTagCompare" tags="mech"/>
      <passive_effect name="DamageModifier" operation="perc_subtract" value="0.95" tags="head"/>
    </effect_group>
  </append>
-->
  <!-- HELPGOOD: add any dismember if helmeted?
  <append xpath="/entity_classes/entity_class[
      starts-with(@name,'zombieUtilityWorker') or
      starts-with(@name,'zombieBiker')
    ]">
    <property name="DismemberMultiplierHead" value="0.33" />
  </append>  
  <append xpath="/entity_classes/entity_class[
      starts-with(@name,'zombieDemolition')
    ]">
    <property name="DismemberMultiplierHead" value="0.15" />
  </append>  
  <append xpath="/entity_classes/entity_class[
      starts-with(@name,'zombieSoldier')
    ]">
    <property name="DismemberMultiplierHead" value="0.05" />
  </append>  
  <append xpath="/entity_classes/entity_class[
      starts-with(@name,'mech')
    ]">
    <property name="DismemberMultiplierHead" value="0.00" />
  </append>
-->
</GhussakTweaks>
